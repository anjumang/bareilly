<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Member Receipt - Anjuman Ghulaman-E-Mustafa</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',system-ui;
  background:linear-gradient(135deg,#f8fafc,#e2e8f0);
  min-height:100vh;
  padding:20px
}
.container{
  max-width:1000px;
  margin:auto;
  background:#fff;
  border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,.1);
  overflow:hidden
}

.receipt-header{
  background:linear-gradient(135deg,#0b4da0,#083a7f);
  color:#fff;
  padding:25px 30px;
  border-bottom:5px solid #10b981
}
.header-top{
  display:flex;
  justify-content:space-between;
  align-items:center
}
.logo{
  width:70px;height:70px;
  border-radius:12px;
  background:rgba(255,255,255,.1);
  padding:5px
}
.logo img{width:100%;height:100%;object-fit:contain}
.header-info{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
  margin-top:15px
}

.profile-section{
  display:flex;
  gap:30px;
  padding:30px;
  border-bottom:1px solid #e2e8f0
}
.profile-image{
  width:150px;height:150px;
  border-radius:50%;
  border:5px solid #e2e8f0;
  object-fit:cover
}
.member-name{
  font-size:2rem;
  color:#0b4da0;
  font-weight:700
}

.payment-table{
  width:100%;
  border-collapse:collapse
}
.payment-table th,
.payment-table td{
  padding:12px;
  border-bottom:1px solid #e2e8f0
}

.summary-cards{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:20px;
  padding:30px
}

.points-display{
  text-align:center;
  padding:40px
}
.progress-bar{
  height:100%;
  background:linear-gradient(90deg,#10b981,#0b4da0)
}

.error-message{
  display:none;
  background:#fee2e2;
  color:#dc2626;
  padding:15px;
  margin:20px;
  border-left:4px solid #dc2626
}
</style>
</head>

<body>
<div class="container">

<!-- HEADER -->
<div class="receipt-header">
  <div class="header-top">
    <div class="logo">
      <img src="https://anjumang.github.io/bareilly/img/logo.png">
    </div>
    <div id="lastUpdatedTime"></div>
  </div>

  <div class="header-info">
    <div>Receipt: <span id="receiptNumber"></span></div>
    <div>Date: <span id="currentDate"></span></div>
    <div>Status: <span id="memberStatus">Loading</span></div>
  </div>
</div>

<!-- ERROR -->
<div id="errorMessage" class="error-message">
  <i class="fas fa-exclamation-triangle"></i>
  <span id="errorText"></span>
</div>

<!-- PROFILE -->
<div class="profile-section">
  <img id="memberImage" class="profile-image" src="">
  <div>
    <div id="memberName" class="member-name"></div>
    <div id="memberPhone"></div>
    <div>Member Since: <span id="memberSince"></span></div>
  </div>
</div>

<!-- PAYMENT TABLE -->
<table class="payment-table">
<thead>
<tr>
  <th>#</th>
  <th>Date</th>
  <th>Month</th>
  <th>Payment</th>
  <th>Points</th>
</tr>
</thead>
<tbody id="paymentHistory"></tbody>
</table>

<!-- SUMMARY -->
<div class="summary-cards">
  <div>Total Paid: ₹<span id="totalPaid">0</span></div>
  <div>Pending: ₹<span id="pending">0</span></div>
  <div>Completion: <span id="completion">0%</span></div>
  <div>Total Points: <span id="totalPoints">0</span></div>
</div>

<!-- POINTS -->
<div class="points-display">
  <div id="displayPoints" style="font-size:48px;font-weight:700">0</div>
  <div style="height:12px;background:#e2e8f0;margin-top:15px">
    <div id="progressBar" class="progress-bar" style="width:0%"></div>
  </div>
  <div id="progressText"></div>
</div>

</div>

<script>
/* ================= UID BASED RECEIPT ================= */

const params = new URLSearchParams(window.location.search);
const uid = params.get("uid");

const now = new Date();
document.getElementById("currentDate").innerText = now.toLocaleDateString("en-IN");
document.getElementById("lastUpdatedTime").innerText = now.toLocaleTimeString("en-IN");
document.getElementById("receiptNumber").innerText =
  "AGM/" + now.getFullYear() + "/" + Math.floor(1000 + Math.random()*9000);

async function loadData(){
  if(!uid){
    showError("UID missing");
    return;
  }

  try{
    const res = await fetch(
      "//anjumang.infinityfreeapp.com/api.php?uid=" + encodeURIComponent(uid)
    );
    const json = await res.json();

    if(!json.success) throw "Member not found";

    const d = json.data;

    document.getElementById("memberStatus").innerText = "Active";
    document.getElementById("memberName").innerText   = d.name;
    document.getElementById("memberPhone").innerText  = d.phone || "N/A";
    document.getElementById("memberSince").innerText  = d.member_since;
    document.getElementById("memberImage").src        = d.image;

    let totalPaid = 0;
    let totalPoints = 0;
    const tbody = document.getElementById("paymentHistory");
    tbody.innerHTML = "";

    d.payments.forEach((p,i)=>{
      totalPaid   += Number(p.payment || 0);
      totalPoints += Number(p.point || 0);

      tbody.innerHTML += `
        <tr>
          <td>${i+1}</td>
          <td>${p.date}</td>
          <td>${p.month}</td>
          <td>₹${p.payment}</td>
          <td>${p.point}</td>
        </tr>`;
    });

    const target = 1200;
    const completion = Math.round((totalPaid/target)*100);

    document.getElementById("totalPaid").innerText     = totalPaid;
    document.getElementById("pending").innerText       = Math.max(0,target-totalPaid);
    document.getElementById("completion").innerText    = completion + "%";
    document.getElementById("totalPoints").innerText   = totalPoints;
    document.getElementById("displayPoints").innerText = totalPoints;

    const prog = Math.min(100,(totalPoints/500)*100);
    document.getElementById("progressBar").style.width = prog + "%";
    document.getElementById("progressText").innerText  = prog.toFixed(1) + "% Complete";

  }catch(e){
    showError("Data load nahi ho pa raha");
  }
}

function showError(msg){
  document.getElementById("errorText").innerText = msg;
  document.getElementById("errorMessage").style.display = "block";
}

loadData();
</script>

</body>
</html>
