<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>बारण रबी उल अव्वल इवेंट मैनेजमेंट</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>  
        /* आपका सारा CSS यहाँ रहेगा */
        :root {  
            --primary: #4a90e2;  
            --secondary: #50c878;  
            --accent: #ff6b6b;  
            --light: #f8f9fa;  
            --dark: #343a40;  
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);  
        }  

        * {  
            margin: 0;  
            padding: 0;  
            box-sizing: border-box;  
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
        }  
        
        body {  
            background-color: #f5f7fa;  
            color: #333;  
            line-height: 1.6;  
        }  
        
        .container {  
            max-width: 1200px;  
            margin: 0 auto;  
            padding: 20px;  
        }  
        
        header {  
            background: linear-gradient(135deg, var(--primary), var(--secondary));  
            color: white;  
            padding: 30px 0;  
            text-align: center;  
            border-radius: 10px;  
            margin-bottom: 30px;  
            box-shadow: var(--shadow);  
        }  
        
        h1 {  
            font-size: 2.5rem;  
            margin-bottom: 10px;  
        }  
        
        .subtitle {  
            font-size: 1.2rem;  
            opacity: 0.9;  
        }  
        
        .dashboard {  
            display: grid;  
            grid-template-columns: 1fr 1fr;  
            gap: 20px;  
            margin-bottom: 30px;  
        }  
        
        .card {  
            background: white;  
            border-radius: 10px;  
            padding: 20px;  
            box-shadow: var(--shadow);  
        }  
        
        .budget-card {  
            grid-column: 1 / -1;  
        }  
        
        .card h2 {  
            color: var(--primary);  
            margin-bottom: 15px;  
            padding-bottom: 10px;  
            border-bottom: 2px solid #eee;  
        }  
        
        .budget-summary {  
            display: flex;  
            justify-content: space-between;  
            margin-bottom: 20px;  
        }  
        
        .budget-item {  
            text-align: center;  
            flex: 1;  
            padding: 15px;  
            cursor: pointer;  
            transition: transform 0.3s, box-shadow 0.3s;  
            border-radius: 8px;  
        }  
        
        .budget-item:hover {  
            transform: translateY(-5px);  
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);  
        }  
        
        .budget-item h3 {  
            font-size: 1.1rem;  
            margin-bottom: 10px;  
            color: var(--dark);  
        }  
        
        .budget-amount {  
            font-size: 1.8rem;  
            font-weight: bold;  
        }  
        
        .total {  
            color: #6c757d;  
        }  
        
        .reserved {  
            color: var(--primary);  
        }  
        
        .spent {  
            color: var(--accent);  
        }  
        
        .remaining {  
            color: var(--secondary);  
        }  
        
        .progress-bar {  
            height: 10px;  
            background: #e9ecef;  
            border-radius: 5px;  
            margin-top: 10px;  
            overflow: hidden;  
        }  
        
        .progress {  
            height: 100%;  
            border-radius: 5px;  
        }  
        
        .total-progress {  
            background: #6c757d;  
            width: 100%;  
        }  
        
        .reserved-progress {  
            background: var(--primary);  
        }  
        
        .spent-progress {  
            background: var(--accent);  
        }  
        
        .remaining-progress {  
            background: var(--secondary);  
        }  
        
        .budget-details {  
            margin-top: 20px;  
        }  
        
        table {  
            width: 100%;  
            border-collapse: collapse;  
        }  
        
        th, td {  
            padding: 12px 15px;  
            text-align: left;  
            border-bottom: 1px solid #ddd;  
        }  
        
        th {  
            background-color: #f8f9fa;  
            font-weight: 600;  
        }  
        
        .member-list {  
            max-height: 400px;  
            overflow-y: auto;  
        }  
        
        .member-item {  
            display: flex;  
            align-items: center;  
            padding: 10px;  
            border-bottom: 1px solid #eee;  
            cursor: pointer;  
            transition: background 0.3s;  
        }  
        
        .member-item:hover {  
            background: #f8f9fa;  
        }  
        
        .member-avatar {  
            width: 40px;  
            height: 40px;  
            border-radius: 50%;  
            background: var(--primary);  
            color: white;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            margin-right: 15px;  
            font-weight: bold;  
        }  
        
        .member-name {  
            flex: 1;  
        }  
        
        .suggestions-container {  
            margin-top: 20px;  
        }  
        
        .suggestion-item {  
            background: #f8f9fa;  
            border-radius: 8px;  
            padding: 15px;  
            margin-bottom: 15px;  
        }  
        
        .suggestion-header {  
            display: flex;  
            justify-content: space-between;  
            margin-bottom: 10px;  
        }  
        
        .suggestion-author {  
            font-weight: bold;  
            color: var(--primary);  
        }  
        
        .suggestion-date {  
            color: #6c757d;  
            font-size: 0.9rem;  
        }  
        
        .suggestion-content {  
            margin-bottom: 10px;  
        }  
        
        .suggestion-media {  
            margin-top: 10px;  
            max-width: 100%;  
            border-radius: 5px;  
            overflow: hidden;  
        }  
        
        .suggestion-media img, .suggestion-media video {  
            max-width: 100%;  
            border-radius: 5px;  
        }  
        
        
        button {  
            background: var(--primary);  
            color: white;  
            border: none;  
            padding: 10px 15px;  
            border-radius: 5px;  
            cursor: pointer;  
            transition: background 0.3s;  
            font-weight: 600;  
        }  
        
        button:hover {  
            background: #3a7bc8;  
        }  
        
        .btn-success {  
            background: var(--secondary);  
        }  
        
        .btn-success:hover {  
            background: #3daa5f;  
        }  
        
        .btn-danger {  
            background: var(--accent);  
        }  
        
        .btn-danger:hover {  
            background: #e05555;  
        }  
        
        .btn-export {  
            background: #6c757d;  
        }  
        
        .btn-export:hover {  
            background: #5a6268;  
        }

        /* UPDATED: Google Form Section Styles */
        .google-form-section {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 30px;
            border-radius: 12px;
            margin-top: 25px;
            border-left: 5px solid #4285f4;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .google-form-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(66, 133, 244, 0.1), rgba(52, 168, 83, 0.1));
            border-radius: 0 0 0 100%;
            z-index: 0;
        }

        .google-form-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }

        .google-form-section h3 {
            color: #4285f4;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            position: relative;
            z-index: 1;
        }

        .google-form-section p {
            color: #5f6368;
            line-height: 1.7;
            margin-bottom: 20px;
            font-size: 1.05rem;
            position: relative;
            z-index: 1;
            text-align: justify;
        }

        .form-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }

        .form-option {
            flex: 1;
            min-width: 200px;
        }

        /* UPDATED: Google Form Button Styles */
        .btn-google-form {
            background: linear-gradient(135deg, #4285f4, #34a853, #fbbc05, #ea4335);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .btn-google-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s;
        }

        .btn-google-form:hover::before {
            left: 100%;
        }

        .btn-google-form:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(66, 133, 244, 0.4);
        }

        .btn-google-form:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(66, 133, 244, 0.3);
        }

        .btn-google-form i {
            font-size: 1.3rem;
        }
        
        .form-group {  
            margin-bottom: 15px;  
        }  
        
        label {  
            display: block;  
            margin-bottom: 5px;  
            font-weight: 600;  
        }  
        
        input, textarea, select {  
            width: 100%;  
            padding: 10px;  
            border: 1px solid #ddd;  
            border-radius: 5px;  
            font-size: 1rem;  
        }  
        
        textarea {  
            min-height: 100px;  
            resize: vertical;  
        }  
        
        .modal {  
            display: none;  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background: rgba(0, 0, 0, 0.5);  
            z-index: 1000;  
            align-items: center;  
            justify-content: center;  
        }  
        
        .modal-content {  
            background: white;  
            border-radius: 10px;  
            width: 90%;  
            max-width: 600px;  
            max-height: 80vh;  
            overflow-y: auto;  
            padding: 20px;  
            box-shadow: var(--shadow);  
        }  
        
        .modal-header {  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
            margin-bottom: 20px;  
            padding-bottom: 10px;  
            border-bottom: 1px solid #eee;  
        }  
        
        .close-modal {  
            background: none;  
            border: none;  
            font-size: 1.5rem;  
            cursor: pointer;  
            color: #6c757d;  
        }  
        
        .tabs {  
            display: flex;  
            margin-bottom: 20px;  
            border-bottom: 1px solid #ddd;  
        }  
        
        .tab {  
            padding: 10px 20px;  
            cursor: pointer;  
            border-bottom: 3px solid transparent;  
        }  
        
        .tab.active {  
            border-bottom: 3px solid var(--primary);  
            color: var(--primary);  
            font-weight: 600;  
        }  
        
        .tab-content {  
            display: none;  
        }  
        
        .tab-content.active {  
            display: block;  
        }  
        
        .detail-item {  
            display: flex;  
            justify-content: space-between;  
            padding: 10px 0;  
            border-bottom: 1px solid #eee;  
        }  
        
        .detail-item:last-child {  
            border-bottom: none;  
        }  
        
        .detail-name {  
            font-weight: 600;  
        }  
        
        .detail-amount {  
            color: var(--dark);  
        }  
        
        .notification {  
            position: fixed;  
            bottom: 20px;  
            right: 20px;  
            padding: 15px 20px;  
            background: var(--secondary);  
            color: white;  
            border-radius: 5px;  
            box-shadow: var(--shadow);  
            display: none;  
            z-index: 1001;  
        }  

        .loading {  
            display: inline-block;  
            width: 20px;  
            height: 20px;  
            border: 3px solid #f3f3f3;  
            border-top: 3px solid #3498db;  
            border-radius: 50%;  
            animation: spin 1s linear infinite;  
            margin-right: 10px;  
        }  

        @keyframes spin {  
            0% { transform: rotate(0deg); }  
            100% { transform: rotate(360deg); }  
        }  

        .btn:disabled {  
            opacity: 0.6;  
            cursor: not-allowed;  
        }  

        .anonymous-form {  
            background: #f8f9fa;  
            padding: 15px;  
            border-radius: 8px;  
            margin-bottom: 15px;  
            border: 1px solid #e9ecef;  
        }

        .anonymous-form h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {  
            .dashboard {  
                grid-template-columns: 1fr;  
            }  
            
            .budget-summary {  
                flex-direction: column;  
            }  
            
            .budget-item {  
                margin-bottom: 15px;  
            }  

            .form-options {
                flex-direction: column;
            }

            .form-option {
                min-width: 100%;
            }
            
            /* UPDATED: Responsive adjustments for Google Form Section */
            .google-form-section {
                padding: 20px;
                margin-top: 20px;
            }
            
            .google-form-section h3 {
                font-size: 1.2rem;
            }
            
            .google-form-section p {
                font-size: 1rem;
            }
            
            .btn-google-form {
                padding: 12px 20px;
                font-size: 1rem;
            }
        }  
    </style>
</head>
<body>   
    <div class="container">  
        <header>  
            <h1>आप की कमेटी, आप की सजावट</h1>

            <div class="google-form-section">
                <h3>
                    <i class="material-icons">assignment</i>
                    फॉर्म के माध्यम से सुझाव दें
                </h3>
                <p>
                    “बाराफ़त के लिए इस बार 9 अलग-अलग सजावट आइडियाज़ तैयार करे!
                    50 मीटर के हर एरिया में सिर्फ 5000 रुपये के बजट में खूबसूरती और स्टाइल का कमाल हो। 
                    कुल 450 मीटर एरिया को शानदार तरीके से सजाया जाए। आपकी राय और सुझाव हमारे लिए महत्वपूर्ण हैं। आइए, अपनी पसंद साझा करें और सजावट को और भी ख़ास बनाने में मदद करें।”
                </p>
                
                <div class="form-options">
                    <div class="form-option">
                        <button class="btn-google-form" onclick="openGoogleForm()">
                            <i class="material-icons">assignment</i>
                            सुझाव दें फॉर्म खोलें
                        </button>
                    </div>
                </div>
            </div> 
        </header>  

        <div class="dashboard">  
            <div class="card budget-card">  
                <h2><i class="material-icons">account_balance</i>बजट डिटेल्स</h2>  
                <div class="budget-summary">  
                    <div class="budget-item" id="total-budget">  
                        <h3>कुल बजट</h3>  
                        <div class="budget-amount total">Loading...</div>  
                        <div class="progress-bar">  
                            <div class="progress total-progress"></div>  
                        </div>  
                    </div>  
                    <div class="budget-item" id="reserved-amount">  
                        <h3>रिजर्व रुपये</h3>  
                        <div class="budget-amount reserved">Loading...</div>  
                        <div class="progress-bar">  
                            <div class="progress reserved-progress"></div>  
                        </div>  
                    </div>  
                    <div class="budget-item" id="spent-amount">  
                        <h3>खर्च की गई राशि</h3>  
                        <div class="budget-amount spent">Loading...</div>  
                        <div class="progress-bar">  
                            <div class="progress spent-progress"></div>  
                        </div>  
                    </div>  
                    <div class="budget-item" id="available-balance">  
                        <h3>उपलब्ध शेष</h3>  
                        <div class="budget-amount remaining">Loading...</div>  
                        <div class="progress-bar">  
                            <div class="progress remaining-progress"></div>  
                        </div>  
                    </div>  
                </div>  
                
                <div class="budget-details">  
                    <h3><i class="material-icons">list_alt</i>कुल खर्चा</h3>  
                    <table>  
                        <thead>  
                            <tr>  
                                <th>सामान आया</th>  
                                <th>पैसे दिए गए</th>  
                                <th>खर्च में आए पैसे</th>  
                                <th>बचत</th>  
                            </tr>  
                        </thead>  
                        <tbody id="expenses-table-body">  
                            <!-- Data will be loaded here from Google Sheets -->
                            <tr>
                                <td colspan="4" class="loading-state">
                                    <div class="loading"></div>डेटा लोड हो रहा है...
                                </td>
                            </tr>
                        </tbody>  
                    </table>  
                </div>  
                
                
            </div>  
            
            <div class="card">  
                <h2><i class="material-icons">people</i>मेम्बरो के लिस्ट</h2>  
                <div class="member-list" id="members-list">  
                    <!-- Data will be loaded here from Google Sheets -->
                    <div class="loading-state">
                        <div class="loading"></div>मेम्बरो के लिस्ट लोड हो रही है...
                    </div>
                </div>  
            </div>  
            
            <div class="card">  
                <h2><i class="material-icons">lightbulb</i>सुझाव</h2>  
                <div class="suggestions-container" id="suggestions-container">  
                    <!-- Data will be loaded here from Google Sheets -->
                    <div class="loading-state">
                        <div class="loading"></div>सुझाव लोड हो रहे हैं...
                    </div>
                </div>  
            </div>  
        </div>  
    </div>  
        
    <!-- Modals -->
    <div class="modal" id="member-details-modal">  
        <div class="modal-content">  
            <div class="modal-header">  
                <h3 id="member-modal-title">सदस्य की जानकारी</h3>  
                <button class="close-modal">&times;</button>  
            </div>  
            <div class="tabs">  
                <div class="tab active" data-tab="info">जानकारी</div>  
                <div class="tab" data-tab="suggestions">सुझाव</div>  
            </div>  
            <div class="tab-content active" id="info-tab">  
                <div class="form-group">  
                    <label>नाम</label>  
                    <p id="member-detail-name">-</p>  
                </div>  
                <div class="form-group">  
                    <label>ईमेल</label>  
                    <p id="member-detail-email">-</p>  
                </div>  
                <div class="form-group">  
                    <label>फोन नंबर</label>  
                    <p id="member-detail-phone">-</p>  
                </div>  
                <div class="form-group">  
                    <label>सुझावों की संख्या</label>  
                    <p id="member-detail-suggestions">-</p>  
                </div>  
            </div>  
            <div class="tab-content" id="suggestions-tab">  
                <div id="member-suggestions-list">  
                    <!-- Suggestions will be loaded here -->  
                </div>  
            </div>  
        </div>  
    </div>  
  
    <div class="modal" id="reserved-details-modal">  
        <div class="modal-content">  
            <div class="modal-header">  
                <h3>परमानेंट खर्चा जो होना है हर हाल में</h3>  
                <button class="close-modal">&times;</button>  
            </div>  
            <div id="reserved-details-content">  
                <!-- Reserved details will be loaded here -->  
            </div>  
        </div>  
    </div>  
  
    <div class="modal" id="spent-details-modal">  
        <div class="modal-content">  
            <div class="modal-header">  
                <h3>खर्च की गई राशि का विवरण</h3>  
                <button class="close-modal">&times;</button>  
            </div>  
            <div id="spent-details-content">  
                <!-- Spent details will be loaded here -->  
            </div>  
        </div>  
    </div>  
  
    <div class="notification" id="notification">  
        सुझाव सफलतापूर्वक जमा हो गया!  
    </div>  

    <script>  
        // Your Google Apps Script Web App URL
        const GOOGLE_SCRIPT_URL = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgTu3_fGHB8Tf9DB9riEfpYbIHa7lnktOSq1DI8OtRf76QgVuO3o1omPdj9IAhnwN55POC4zRBLfGhWoHysa_ZAQn3vP1zr3ZaV-etF-HD33zzCXyzPlxnxplY8kUhOtfFEDSpHkWOweHdaPTRVdYe8s_n3hxEnSOhFtBxDkjXWvgcFhiSITOWVuf_HrGOvkXrOO2s0L7o7HdYRS74bYbQ8-Kdxdtw92x4lhwZksEd-TXfb5fNjquGMZ5r3O7Xd6YVHJozCaLEOKzVsIrOY9_4EWpHXLQ&lib=MTF7K1p6lIO18CBwhBt27vOKkGZzaX1Ik'; 

        // Google Form URL
        const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeN0fDvIoyynb7y65ME3_nxpV9JOwHWXKMFAetZyqAD1VQW2Q/viewform?usp=dialog';

        // Performance optimization: Cache data
        let cachedData = null;
        let lastFetchTime = 0;
        const CACHE_DURATION = 30000; // 30 seconds

        // Google Form Functions
        function openGoogleForm() {
            window.open(GOOGLE_FORM_URL, '_blank', 'noopener,noreferrer');
            showNotification('Google Form नई विंडो में खुल रहा है...');
        }

        // Function to fetch data from Google Sheets with caching
        async function fetchDataFromGoogleSheets() {
            // Return cached data if it's still valid
            const now = Date.now();
            if (cachedData && (now - lastFetchTime) < CACHE_DURATION) {
                console.log('Returning cached data');
                return cachedData;
            }
            
            try {
                console.log('Fetching data from Google Sheets...');
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                
                const response = await fetch(GOOGLE_SCRIPT_URL, { 
                    signal: controller.signal 
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                
                // Cache the data
                cachedData = data;
                lastFetchTime = now;
                
                return data;
            } catch (error) {
                console.error('Error fetching data from Google Sheets:', error);
                
                // If we have cached data, return it even if it's stale
                if (cachedData) {
                    console.log('Using stale cached data due to fetch error');
                    return cachedData;
                }
                
                throw error;
            }
        }

        // Function to update budget summary
        async function updateBudgetSummary() {
            try {
                const data = await fetchDataFromGoogleSheets();
                
                // Update the budget summary
                document.querySelector('#total-budget .budget-amount').textContent = `${data.totalBudget.toLocaleString('hi-IN')} रुपये`;
                document.querySelector('#reserved-amount .budget-amount').textContent = `${data.reservedAmount.toLocaleString('hi-IN')} रुपये`;
                document.querySelector('#spent-amount .budget-amount').textContent = `${data.spentAmount.toLocaleString('hi-IN')} रुपये`;
                document.querySelector('#available-balance .budget-amount').textContent = `${data.availableBalance.toLocaleString('hi-IN')} रुपये`;
                
                // Update progress bars with animation
                setTimeout(() => {
                    document.querySelector('.reserved-progress').style.width = `${(data.reservedAmount / data.totalBudget) * 100}%`;
                    document.querySelector('.spent-progress').style.width = `${(data.spentAmount / data.totalBudget) * 100}%`;
                    document.querySelector('.remaining-progress').style.width = `${(data.availableBalance / data.totalBudget) * 100}%`;
                }, 100);
                
                // Update detailed expenses table
                const tableBody = document.getElementById('expenses-table-body');
                tableBody.innerHTML = '';
                
                if (data.expenses && data.expenses.length > 0) {
                    data.expenses.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.category}</td>
                            <td>${item.allocated.toLocaleString('hi-IN')} रुपये</td>
                            <td>${item.spent.toLocaleString('hi-IN')} रुपये</td>
                            <td>${item.savings.toLocaleString('hi-IN')} रुपये</td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">कोई डेटा उपलब्ध नहीं है</td></tr>';
                }
                
                // Update reserved details modal
                const reservedContent = document.getElementById('reserved-details-content');
                reservedContent.innerHTML = '';
                
                if (data.reservedDetails && data.reservedDetails.length > 0) {
                    data.reservedDetails.forEach(item => {
                        const detailItem = document.createElement('div');
                        detailItem.className = 'detail-item';
                        detailItem.innerHTML = `
                            <div class="detail-name">${item.name}</div>
                            <div class="detail-amount">${item.amount.toLocaleString('hi-IN')} रुपये</div>
                        `;
                        reservedContent.appendChild(detailItem);
                        
                        if (item.details) {
                            const description = document.createElement('div');
                            description.className = 'detail-description';
                            description.textContent = item.details;
                            description.style.fontSize = '0.9rem';
                            description.style.color = '#6c757d';
                            description.style.marginTop = '5px';
                            reservedContent.appendChild(description);
                        }
                    });
                } else {
                    reservedContent.innerHTML = '<p>कोई आरक्षित विवरण उपलब्ध नहीं है</p>';
                }
                
                // Update spent details modal
                const spentContent = document.getElementById('spent-details-content');
                spentContent.innerHTML = '';
                
                if (data.spentDetails && data.spentDetails.length > 0) {
                    data.spentDetails.forEach(item => {
                        const detailItem = document.createElement('div');
                        detailItem.className = 'detail-item';
                        detailItem.innerHTML = `
                            <div class="detail-name">${item.name}</div>
                            <div class="detail-amount">${item.amount.toLocaleString('hi-IN')} रुपये</div>
                        `;
                        spentContent.appendChild(detailItem);
                        
                        if (item.details) {
                            const description = document.createElement('div');
                            description.className = 'detail-description';
                            description.textContent = item.details;
                            description.style.fontSize = '0.9rem';
                            description.style.color = '#6c757d';
                            description.style.marginTop = '5px';
                            spentContent.appendChild(description);
                        }
                    });
                } else {
                    spentContent.innerHTML = '<p>कोई खर्च विवरण उपलब्ध नहीं है</p>';
                }
                
                // Update members list and dropdown
                const memberList = document.getElementById('members-list');
                memberList.innerHTML = '';
                
                if (data.members && data.members.length > 0) {
                    data.members.forEach(member => {
                        // Update members list
                        const memberItem = document.createElement('div');
                        memberItem.className = 'member-item';
                        memberItem.setAttribute('data-member', member.id);
                        memberItem.innerHTML = `
                            <div class="member-avatar">${member.name.charAt(0)}</div>
                            <div class="member-name">${member.name}</div>
                        `;
                        memberList.appendChild(memberItem);
                    });
                } else {
                    memberList.innerHTML = '<p>कोई सदस्य उपलब्ध नहीं है</p>';
                }
                
                // Update suggestions
                const suggestionsContainer = document.getElementById('suggestions-container');
                suggestionsContainer.innerHTML = '';
                
                if (data.suggestions && data.suggestions.length > 0) {
                    data.suggestions.forEach(suggestion => {
                        const suggestionItem = document.createElement('div');
                        suggestionItem.className = 'suggestion-item';
                        suggestionItem.innerHTML = `
                            <div class="suggestion-header">
                                <div class="suggestion-author">${suggestion.author || 'अनाम'}</div>
                                <div class="suggestion-date">${suggestion.date}</div>
                            </div>
                            <div class="suggestion-content">
                                ${suggestion.content}
                            </div>
                            ${suggestion.media ? `
                            <div class="suggestion-media">
                                <img src="${suggestion.media}" alt="सुझाव मीडिया">
                            </div>
                            ` : ''}
                        `;
                        suggestionsContainer.appendChild(suggestionItem);
                    });
                } else {
                    suggestionsContainer.innerHTML = '<p>कोई सुझाव उपलब्ध नहीं है</p>';
                }
                
                // Re-attach event listeners to new member items
                attachMemberEventListeners();
                
            } catch (error) {
                console.error('Error updating budget summary:', error);
                // Don't show alert if we're using cached data
                if (!cachedData) {
                    showNotification('डेटा लोड करने में त्रुटि हुई है। कृपया बाद में पुनः प्रयास करें।');
                }
            }
        }

        // Function to attach event listeners to member items
        function attachMemberEventListeners() {
            const memberItems = document.querySelectorAll('.member-item');
            memberItems.forEach(item => {
                item.addEventListener('click', async () => {
                    const memberId = item.getAttribute('data-member');
                    await loadMemberDetails(memberId);
                    document.getElementById('member-details-modal').style.display = 'flex';
                });
            });
        }

        // Function to show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Modal functionality
        const modals = document.querySelectorAll('.modal');
        const closeButtons = document.querySelectorAll('.close-modal');
        
        document.getElementById('reserved-amount').addEventListener('click', () => {
            document.getElementById('reserved-details-modal').style.display = 'flex';
        });
        
        document.getElementById('spent-amount').addEventListener('click', () => {
            document.getElementById('spent-details-modal').style.display = 'flex';
        });
        
        closeButtons.forEach(button => {
            button.addEventListener('click', () => {
                modals.forEach(modal => {
                    modal.style.display = 'none';
                });
            });
        });
        
        window.addEventListener('click', (e) => {
            modals.forEach(modal => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                tabs.forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                tab.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        async function loadMemberDetails(memberId) {
            try {
                const data = await fetchDataFromGoogleSheets();
                const member = data.members.find(m => m.id == memberId);
                
                if (member) {
                    document.getElementById('member-modal-title').textContent = member.name;
                    document.getElementById('member-detail-name').textContent = member.name;
                    document.getElementById('member-detail-email').textContent = member.email;
                    document.getElementById('member-detail-phone').textContent = member.phone;
                    
                    const memberSuggestions = data.suggestions.filter(s => s.author === member.name);
                    document.getElementById('member-detail-suggestions').textContent = memberSuggestions.length;
                    loadMemberSuggestions(member.name);
                }
            } catch (error) {
                console.error('Error loading member details:', error);
            }
        }
        
        function loadMemberSuggestions(memberName) {
            const suggestionsContainer = document.getElementById('member-suggestions-list');
            suggestionsContainer.innerHTML = '';
            
            fetchDataFromGoogleSheets().then(data => {
                const memberSuggestions = data.suggestions.filter(s => s.author === memberName);
                
                if (memberSuggestions.length === 0) {
                    suggestionsContainer.innerHTML = '<p>इस सदस्य ने अभी तक कोई सुझाव नहीं दिया है।</p>';
                    return;
                }
                
                memberSuggestions.forEach(suggestion => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'suggestion-item';
                    suggestionItem.innerHTML = `
                        <div class="suggestion-header">
                            <div class="suggestion-date">${suggestion.date}</div>
                        </div>
                        <div class="suggestion-content">
                            ${suggestion.content}
                        </div>
                    `;
                    suggestionsContainer.appendChild(suggestionItem);
                });
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async () => {
            // Show loading states
            document.querySelectorAll('.loading-state').forEach(el => {
                el.style.display = 'flex';
            });
            
            // Initial data load
            await updateBudgetSummary();
            
            // Set up periodic refresh (every 30 seconds)
            setInterval(updateBudgetSummary, 30000);
        });
    </script>
</body>
</html>